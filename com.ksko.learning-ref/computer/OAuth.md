OAuth 2.0 RFC 6749 문서 + search

1 소개
====
전통적으로 클라이언트-서버 인증 모델에서 써드 파티 애플리케이션이 접근이 제한된 리소스에 접근하도록 하기 위해 리소스 오너의 credential을 공유했다.
써드파티는 비밀번호(clear-text)를 저장하고 싶어했고, 서버는 이를 인증해야만 했다.
OAuth는 role을 분리시키고 리소스 오너로부터 클라이언트를 인증하는 방식을 제공했다. 기존에 써드 파티가 리소스 오너의 credential을 사용하는 것 대신에 access token을 얻었다.
access token은 여러 정보(scope, lifetime, ...)를 포함했다.
OAuth 2.0은 OAuth 1.0 과 호환되고, 두 버전을 동시에 지원한다.

role에는 네가지가 있다.

1. 리소스 오너
end-user라고도 한다. 보호된 리소스에 접근할 권한을 줄수있다.

2. 리소스 서버
보호된 리소스를 제공하는 서버. 

3. 클라이언트
보호된 리소스를 요청하는 애플리케이션

4. 인증 서버
인증이 완료되면 access token을 발급한다.

리소스 서버는 인증 서버와 같은 서버(물리적)일 수 있다. 하나의 인증 서버가 여러 리소스 서버에 엑세스할 수 있는 토큰을 발행할 수 있다.

1.2 프로토콜 흐름
----

1. 클라이언트 -> 리소스 오너 : 인증을 요청한다. 
   리소스 -> 클라이언트 : 리소스 오너의 인증이 표현되는 credential인 인증 허가를 받는다. 
 
2. 클라이언트 -> 인증 서버 : 클라이언트는 인증 허가를 보여주고 access token을 요청한다.
   인증 서버 -> 클라이언트 : 인증 허가를 validate하고, 유효하면 access token을 발급한다.
   
3. 클라이언트 -> 리소스 서버 : 클라이언트는 access token을 보여주고 보호된 리소스를 요청한다.
   리소스 서버 -> 클라이언트 : 리소스 서버는 access token을 validate하고 유효하면 응답한다.
   
리소스 오너로부터 인증 허가를 받는 선호되는 방식은 (위의 1번) 인증 서버를 중간 매개체로 사용하는 것이다.

1.3 권한 증서
----
권한 증서는 access token을 얻기 위해 클라이언트가 리소스 오너의 인증을 보여주는 credential이다. 증서에는 네개의 타입이 있다.

# 1.3.1 인증 코드
인증코드는 리소스 오너에게 직접적으로 인증을 요청하는 것 대신에, 클라이언트는 리소스오너를 인증 서버로 보내고, **리소스 오너와 권한을 인증한 이후** 에 을인증 코드와 함께 리소스 오너를 클라이언트로 되돌려보낸다.
(클라이언트->요청->리소스오너->요청->인증서버)
(인증서버->인증코드 반환->리소스오너->인증코드반환->클라이언트)
(클라이언트->인증코드와함께요청->인증서버)
(인증서버->access token 발급->클라이언트)

리소스 오너는 오직 인증 서버에서만 인증받기 떄문에 리소스 오너의 credential은 절대 클라이언트와 공유될 수 없다. 인증 코드는 보안 상 여러 이점을 제공하는데, access token 뿐 아니라 리소스 오너를 포함해서 다른 사람들에게 잠재적인 유출을 방지한다.

# 1.3.2 Implicit(암시적 승인)
인증 코드가 없이 인증서버로부터 access token을 바로 발급받는다. 자바스크립트에 직접 박아서 사용한다. 인증 서버는 클라이언트를 인증하지 않는다. 라운드트립을 감소시키기 때문에 몇몇 클라이언트에게는 효율적이지만(브라우저 안의 앱같은 경우), 보안 측면을 고려해야한다.

# 1.3.3 리소스 오너 암호 인증
username, password 같은 정보로 직접 인증서버에 access token을 요청한다. 리소스 오너와 클라이언트 사이에 높은 신뢰가 있을 때 credential을 사용한다. ling-lived한 access token이나 refresh token과 credential을 교환해서 클라이언트는 리소스 오너 credential을 저장할 필요가 없다.

(클라이언트->ID,PW로 요청->인증서버)
(인증서버->access token 반환->클라이언트)

# 1.3.4 클라이언트 credential
클라이언트가 리소스 오너가 된다.

1.4 엑세스 토큰
----
엑세스 토큰은 보호된 리소스에 접근하기 위해 사용되는 credential이다. 엑세스 토큰은 문자열이고 클라이언트에게 보통 불투명하다. 토큰은 scope, 접근 기간 등의 정보를 지닌다.

1.5 리프레시 토큰
----
리프레시 토큰은 엑세스 토큰을 얻기위해 사용되는 credential이다. 유효기간이 만료되거나 부가적인 엑세스 토큰을 얻을 때 새로운 엑세스 토큰을 얻기위해 사용된다.
엑세스 토큰과는 달리 리프레시 토큰은 인증서버에만 사용되는 경향이 있고 리소스 서버에 절대 보내지 않는다.

1.6 TLS 버전
----
엑세스 토큰은 TLS로 보호된 채널을 통해 전송되어야한다.

1.7 HTTP 리다이렉션
----
URL 변조가 있을 수 있기 때문에 URL의 full path(일부가 아니라!) 를 확인해야 한다.

